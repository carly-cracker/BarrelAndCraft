<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cart - Barrel & Craft</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <nav class="glass-nav">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-wine-glass"></i>
                <span>Barrel & Craft</span>
            </div>
            <ul class="nav-links">
                <li><a href="home.html" class="nav-link">Home</a></li>
                <li><a href="shop.html" class="nav-link">Shop</a></li>
                <li><a href="#whiskey" class="nav-link">Whiskey</a></li>
                <li><a href="#craft-beer" class="nav-link">Craft Beer</a></li>
            </ul>
            <div class="nav-icons">
                <a href="#" class="nav-icon" aria-label="Search">
                    <i class="fas fa-search"></i>
                </a>
                <a href="#" class="nav-icon cart-icon" aria-label="Shopping Cart">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </a>
            </div>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <main class="cart-container">
        <h2>Your Cart</h2>
        <div id="cart-items"></div>
        <div id="cart-summary"></div>
    </main>

    <script>
    // 1. Utility functions
    function getCart() {
        try { 
            return JSON.parse(localStorage.getItem('cart') || '[]'); 
        } catch (e) { 
            return []; 
        }
    }

    function saveCart(cart) {
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
        updateCartCount();
    }

    function updateCartCount() {
        const countEls = document.querySelectorAll('.cart-count');
        const cart = getCart();
        const total = cart.reduce((sum, item) => sum + (Number(item.quantity) || 1), 0);
        countEls.forEach(el => el.textContent = total);
    }

    // 2. Rendering logic
    const container = document.getElementById('cart-items');
    const summary = document.getElementById('cart-summary');

    function renderCart() {
        const cart = getCart();
        if (!cart.length) {
            container.innerHTML = '<div class="empty-msg"><p>Your cart is empty.</p><a href="shop.html">Go Shopping</a></div>';
            summary.innerHTML = '';
            return;
        }

        container.innerHTML = cart.map(item => `
            <div class="cart-item" data-id="${item.id}">
                <img src="${item.image || 'https://via.placeholder.com/100'}" alt="${item.name}">
                <div class="cart-item-info">
                    <h4>${item.name}</h4>
                    <div class="cart-controls">
                        <button type="button" class="qty-btn decrease" data-id="${item.id}">âˆ’</button>
                        <span class="qty-display">${item.quantity || 1}</span>
                        <button type="button" class="qty-btn increase" data-id="${item.id}">+</button>
                    </div>
                    <div class="cart-price">$${(item.price * (item.quantity || 1)).toFixed(2)}</div>
                    <button type="button" class="remove-item" data-id="${item.id}">
                        <i class="fas fa-trash"></i> Remove
                    </button>
                </div>
            </div>
        `).join('');

        const total = cart.reduce((s, i) => s + (Number(i.price) * (Number(i.quantity) || 1)), 0);
        summary.innerHTML = `
            <div class="cart-total-box">
                <h3>Order Summary</h3>
                <div class="total-line"><span>Total:</span> <span>$${total.toFixed(2)}</span></div>
                <button class="checkout-btn">Proceed to Checkout</button>
            </div>
        `;
    }

    container.addEventListener('click', (e) => {
        
        const btn = e.target.closest('button');
        if (!btn) return;

        e.preventDefault(); 
        const id = Number(btn.dataset.id);
        let cart = getCart();
        const itemIndex = cart.findIndex(x => Number(x.id) === id);

        if (btn.classList.contains('increase')) {
            if (itemIndex > -1) {
                cart[itemIndex].quantity = (cart[itemIndex].quantity || 1) + 1;
            }
        } 
        else if (btn.classList.contains('decrease')) {
            if (itemIndex > -1) {
                if (cart[itemIndex].quantity > 1) {
                    cart[itemIndex].quantity -= 1;
                } else {
                    
                    cart = cart.filter(x => Number(x.id) !== id);
                }
            }
        } 
        else if (btn.classList.contains('remove-item')) {
            cart = cart.filter(x => Number(x.id) !== id);
        }

        saveCart(cart);
    });

    renderCart();
    updateCartCount();
</script>
</body>
</html>
